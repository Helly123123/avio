

---

## recommendationsHook

### Описание

Этот хук предназначен для обработки webhook-уведомлений от внешнего сервиса (например, нейросети), который возвращает рекомендации для пользователя. Хук:
- Получает POST-запрос с результатом работы нейросети.
- Обновляет статус и стоимость запроса в базе.
- Парсит рекомендации из ответа.
- Отправляет результат на фронтенд по адресу, указанному в переменной окружения `FRONTEND_WEBHOOK_URL`.

### URL

`POST /api/hooks/recommendationsHook`

### Ожидаемый формат запроса

```json
{
  "request_id": 123456,
  "status": "done",
  "cost": 0.01,
  "result": [
    {
      "message": {
        "content": "Текст с рекомендациями..."
      }
    }
  ]
}
```

### Ответы

- **200 OK**
  ```json
  { "message": "Data processed and forwarded to frontend successfully" }
  ```
- **400 Bad Request**
  ```json
  { "error": "Invalid data format" }
  ```
- **500 Internal Server Error**
  ```json
  { "error": "Internal server error", "details": "..." }
  ```

### Как использовать

1. Укажите в стороннем сервисе callback/webhook URL: `/api/hooks/recommendationsHook`.
2. После завершения генерации рекомендаций сервис отправит POST-запрос в этот хук.
3. Хук автоматически обработает данные, сохранит их и отправит на фронтенд.

---

## tasksHooks

### Описание

Этот хук предназначен для обработки webhook-уведомлений от внешнего сервиса, который возвращает сгенерированные задачи для пользователя. Хук:
- Получает POST-запрос с результатом работы нейросети.
- Обновляет статус и стоимость запроса в базе.
- Парсит задачи из ответа.
- Сохраняет задачи в базе.
- Отправляет результат на фронтенд по адресу, указанному в переменной окружения `FRONTEND_WEBHOOK_URL`.

### URL

`POST /api/hooks/tasksHooks`

### Ожидаемый формат запроса

```json
{
  "request_id": 123456,
  "status": "done",
  "cost": 0.01,
  "result": [
    {
      "message": {
        "content": "Текст с задачами в формате JSON..."
      }
    }
  ]
}
```

### Ответы

- **200 OK**
  ```json
  {
    "success": true,
    "data": [ ... ],         // распарсенные задачи
    "original": { ... },     // оригинальный webhookData
    "status": "...",
    "cost": 0.01,
    "tasks": [ ... ]         // созданные задачи в базе
  }
  ```
- **400 Bad Request**
  ```json
  { "error": "Invalid data format" }
  ```
- **500 Internal Server Error**
  ```json
  { "error": "Internal server error", "details": "..." }
  ```

### Как использовать

1. Укажите в стороннем сервисе callback/webhook URL: `/api/hooks/tasksHooks`.
2. После завершения генерации задач сервис отправит POST-запрос в этот хук.
3. Хук автоматически обработает данные, сохранит задачи в базе и отправит результат на фронтенд.

---

## Общие рекомендации

- Оба хука ожидают, что внешний сервис будет отправлять данные строго в описанном формате.
- Для корректной работы обязательно настройте переменную окружения `FRONTEND_WEBHOOK_URL` — туда будут отправляться результаты для фронтенда.
- В случае ошибок хук попытается отправить ошибку на фронтенд.
